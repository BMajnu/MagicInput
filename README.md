# MagicInput

A minimalistic popup GUI for entering text/code and attaching images, designed for quick input and interaction with AI models.

## Installation

1.  **Clone the repository:**

    ```bash
    git clone https://github.com/your-repo/MagicInput.git
    cd MagicInput
    ```

2.  **Install dependencies:**

    It is highly recommended to use a virtual environment to manage dependencies.

    ```bash
    python -m venv venv
    ./venv/Scripts/activate  # On Windows
    source venv/bin/activate  # On macOS/Linux
    
    pip install -r requirements.txt
    ```

## Usage

To run the application:

```bash
python MagicInput.py
```

## Features

*   **Modern Popup UI:** Frameless, centered window with custom title bar and theme.
*   **Text/Code Input:** Prompt editor with undo/redo, cut/copy/paste, select all, and move-selection up/down.
*   **Image Attachment:** Add images via file dialog and drag-and-drop; in-memory storage; preview with next/prev and counter.
*   **File Attachment:** Attach arbitrary files; inline mentions are inserted into the prompt automatically.
*   **Clipboard Paste (Ctrl+V):** Paste an image from the system clipboard directly into attachments.
*   **Visionize (Image + Text AI):** Describe/analyze attached images with modes: Plan, Describe, Combine.
*   **Context Toggles:** Include Project brief, Prompts archive, and Terminal context when analyzing.
*   **Footer Toggle:** Quickly include/exclude an informational footer line appended to your prompt. The footer adapts based on whether images or files are attached.
*   **Prompt Refinement:** One-click AI-powered rewrite/refine of your prompt.
*   **Visionize & Send:** Run analysis then immediately send the prompt.
*   **Prompt Persistence:** Keeps only the latest prompt in `MagicInput/MagicInput Prompt.txt` and archives previous entries in `MagicInput/Prompts Archive.txt`.
*   **Waiting Indicator:** Shows an infinite count-up timer while waiting for user input.
*   **System Tray (Windows):** Minimize to tray with Show and Exit actions.
*   **Theming:** Toggle between dark and light themes.
*   **Settings Dialog:** Manage Gemini API keys (multiple with rotation), select model, and toggle auto-refine.
*   **Drag-and-Drop:** Drop files/images onto the window (Windows uses `tkinterdnd2`).
*   **Startup Sound:** Plays a short sound when the app opens (customizable WAV on Windows).
*   **Custom Title Format:** Title shows `<codebase> - MagicInput - B Majnu (Developer)`.
*   **Reliable Exit:** "Send & Close" sends the prompt, closes the window, and terminates the process.

## Visionize modes (Image Analysis)

MagicInput integrates Google Gemini for multimodal image+text analysis.

- **Plan:** Generate a step-by-step plan based on the image(s) and optional prompt.
- **Describe:** Produce a concise, professional description of the image(s).
- **Combine:** Merge planning and description for a hybrid output.

Outputs are inserted into the prompt as:

```
## Analysis
<generated content>

---
*Analysis Generated by AI*
```

Use the buttons: `Visionize` (generate into prompt) or `Visionize & Send` (generate then send).

## Context & Prompt Logging

- **Include context** checkbox shows additional toggles:
  - Project brief
  - Prompts archive
  - Terminal
- **Footer toggle:** When enabled, MagicInput appends a footer line to the prompt. If images are attached, it adds:

  "Please take a screenshot of the current page to understand properly my requirements. After analyzing it, start implementing."

  Otherwise, it adds:

  "read the [attachment types] (following the directory link) mentioned above."

- The latest prompt is written to `MagicInput/MagicInput Prompt.txt`.
- Older prompts are prepended to `MagicInput/Prompts Archive.txt` (newest-first) with timestamps and separators.
- A status line shows “Waiting for prompt: Xs” with a count-up timer.

## Keyboard Shortcuts

- Ctrl+Z / Ctrl+Shift+Z / Ctrl+Y: Undo/Redo
- Ctrl+X / Ctrl+C / Ctrl+V: Cut/Copy/Paste (Ctrl+V pastes clipboard image if available)
- Ctrl+A: Select all
- Alt+Up / Alt+Down: Move selected lines up/down

## Drag & Drop and Clipboard

- Drag and drop image files onto the preview canvas.
- Drag and drop files anywhere supported to attach and insert mentions.
- Press Ctrl+V to paste an image from the clipboard into attachments.

## System Tray and Window Behavior

- Windows tray icon with Show/Exit.
- Frameless window with custom title bar, movable by dragging.
- Theme toggle (sun/moon) on the title bar.

## Settings, Models, and API Keys

- Select a Gemini model (default `gemini-2.5-flash`).
- Manage multiple API keys, set active order, and rotate automatically on rate limits.
- Option: Auto refine prompt before send.
- Config is persisted to `MagicInput/config.json`.

## Configuration

*   **Gemini API Key:**
    - Set `GEMINI_API_KEY` as an environment variable, or
    - Open Settings (⚙) and add one or more keys.
*   **Model:** Choose the desired model in Settings.
*   **Config File:** Preferences are saved to `MagicInput/config.json`.

### Startup Sound (Windows)

By default the app plays the WAV at:

```
e:\Developing Projects\MagicInput\Sound\mixkit-negative-tone-interface-tap-2569.wav
```

To change the sound, edit `InputPopup._play_start_sound()` in `MagicInput.py` and update `wav_path` to your desired `.wav` file. If the file is missing, the app falls back to the `SystemNotification` sound or a simple beep.

### Window Title Format

The window title is set dynamically to:

```
<codebase> - MagicInput - B Majnu (Developer)
```

`<codebase>` is the name of the folder where `MagicInput.py` is run. The same text is displayed in the custom title bar.

## Files & Storage

- App data folder: `MagicInput/` (created beside `MagicInput.py`).
- Logs: `MagicInput/debug.log` and `MagicInput/magicinput.log`.
- Prompts: `MagicInput/MagicInput Prompt.txt` (latest), `MagicInput/Prompts Archive.txt` (history).
- Attachments: files added are copied into the app data folder and referenced in the prompt.
- Attachment path handling: inline mentions in the prompt use relative paths for readability, while the app uses absolute file paths internally when reading and sending attachments to AI APIs.

## Troubleshooting

*   **Missing Dependencies:** If you encounter `ImportError` messages, ensure you have installed all dependencies using `pip install -r requirements.txt`.
*   **UI Freezes/Lag:** If the application becomes unresponsive, it might be due to heavy operations. Ensure your system meets the minimum requirements and consider restarting the application.
*   **Terminal Doesn’t Exit After Send & Close:** This has been addressed. If you still see the Python process lingering, ensure you’re on the latest code; the app now forces termination shortly after shutdown.

## Contributing

Contributions are welcome! Please open an issue or submit a pull request.

## License

This project is licensed under the MIT License - see the `LICENSE` file for details.